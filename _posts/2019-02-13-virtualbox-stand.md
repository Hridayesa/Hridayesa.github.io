---
title: "Создание 'стендов' на основе VirtualBox"
---

> Создание нескольких виртуалок с linux с "правильно" настроеной сетью.
<!--more-->

# Задача
Создать несколько виртуалок с linux (для примера CentOS), которые будут 
* "видеть" друг друга
* "видны" с хостовой машины
* иметь доступ в интернет (например для работы yum)

# Настройка VirtualBox и создание виртуалок
Самый простой способ решить эту задачу, это создать для кажной виртуалки два сетевых интерфейса
* Host only adapter
* Nat

## Для этого сначала нужно создать в VirtualBox'е Host-only network.
В интерфейсе VirtualBox выбрать пункт меню File/Host Network Manager
Далее нажать Create
* ip = 192.168.56.1
* mask = 255.255.255.0

## Создать необходимое количество виртуалок
> технологичней сделать одну, установить и настроить базовый софт, а потом склонировать необходимое количество

## Создать и настроить два сетевых интерфейса в каждой виртуалке.
В настройках виртуалки(Settings) выбрать закладку Network
Настроить два адаптера:
1. __Host-only Adapter__. В качестве имени будет доступен созданый на пером шаге Host-only network
1. __Nat__. Ничего дополнительно конфигурировать не нужно

# Установка CentOS'ов и настройка сети в них
При установке CentOS можно большую часть настроек сети сделать из инстолятора.
Для первого сетевого интерфейса(__Host-only Adapter__) предлагаю делать статический ID.
Соответственно прописать
* ip = 192.168.56._xx_
* mask = 255.255.255.0
* gate = 192.168.56.1
> Значения данных ip обусловленно раннее настроеным __Host-only network__

Всю настройку сети можно сделать и потом, путем редактирования файлов.
файл, соответствующий первому интерфейсу, скорей всего у вас будет `/etc/sysconfig/network-scripts/ifcfg-enp0s3`
в этом файле должны присутствовать следующие строчки
```
...
BOOTPROTO=static
ONBOOT=yes
DEFROUTE=no   # !!! Важно
IPADDR=192.168.56.XX   # XX конкретный ip данной VM
NETWORK=192.168.56.0
NETMASK=255.255.255.0
GATEWAY=192.168.56.1
DNS=8.8.8.8 192.168.56.1  # DNS servers
NM_CONTROLLED=no     #use this file not network manager to manage interface
...
```

Файл, соответствующий второму интерфейсу, скорей всего у вас будет `/etc/sysconfig/network-scripts/ifcfg-enp0s8`
Убедитесь, что в нем присутствуют следующие настройки
```
...
ONBOOT=yes
DEFROUTE=yes
...
```

`DEFROUTE` здесь будет означать, то что все запросы с ip отличными от `192.168.56.xx` будут направлятся на второй интерфейс(NAT). Грубо говоря "наружу" "в интернет"

# Настройка SSH (опционально)
Это не установка в "пород", а создание стенда для эксперементов и тестов, поэтому в ряде случаев удобно иметь рутовый доступ по SSH.
Чтобы его разрешить нужно выстовить параметр `PermitRootLogin yes` и что бы процес логина не тормозил стоит сбросить флажок `UseDNS no`

В файле `/etc/ssh/sshd_config`
```
PermitRootLogin yes
UseDNS no
```

# Полезные команды и имена файлов
* `ip add` - вывод списока сетевых интерфейсов
* `systemctl restart network.service` - перезапуск сети, после внесения изменений в настройки
* `systemctl restart sshd.service` - перезапуск SSH, после внесения изменений в настройки

* `/etc/sysconfig/network-scripts/xxxx` - конфигурационные файлы сетевых интерфейсов
* `/etc/ssh/sshd_config` - конфигурационный файл SSH
